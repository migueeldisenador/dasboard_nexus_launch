<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nexus Lanzamiento Dashboard</title>
    
    <!-- 1. Cargar Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. Cargar Chart.js (para los gráficos) -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>
    
    <!-- 3. Cargar Lucide (iconos) -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    
    <!-- 4. Cargar la fuente (Inter) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">

    <style>
        /* ESTILOS PERSONALIZADOS (CSS) */
        
        :root {
            font-family: 'Inter', sans-serif;
        }

        body {
            background-color: #0B1120; /* Fondo principal oscuro */
        }

        /* Efecto "Glassmorphism" (vidrio) */
        .glass-card {
            background: rgba(40, 51, 80, 0.4); /* Color de fondo semi-transparente */
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(100, 116, 139, 0.3); /* Borde sutil */
        }

        /* Estilo de los widgets principales */
        .widget-card {
            background-color: #131B33; /* Fondo de las tarjetas */
            border: 1px solid #222B45; /* Borde de las tarjetas */
        }
        
        /* Efecto de brillo para los gráficos */
        .chart-glow {
            filter: drop-shadow(0 0 10px rgba(59, 130, 246, 0.3));
        }

        /* Animación de carga (esqueleto/shimmer) */
        .skeleton {
            position: relative;
            overflow: hidden;
            background-color: #1E293B; /* Color base del esqueleto */
            border-radius: 0.5rem;
        }
        .skeleton::after {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(51, 65, 85, 0.5), transparent);
            animation: shimmer 2s infinite linear;
        }
        @keyframes shimmer {
            0% { left: -100%; }
            100% { left: 100%; }
        }
        
        /* Ocultar elementos */
        .hidden-page {
            display: none;
        }
        
        /* Estilos de la barra de scroll */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #0B1120; }
        ::-webkit-scrollbar-thumb { background-color: #222B45; border-radius: 20px; }
        ::-webkit-scrollbar-thumb:hover { background-color: #334155; }

        /* Estilos para Tablas */
        .data-table {
            border-collapse: separate;
            border-spacing: 0 0.5rem; /* Espacio vertical entre filas */
        }
        .data-table th {
            color: #94a3b8; /* slate-400 */
            font-weight: 600;
            text-align: left;
            padding: 0.75rem 1rem;
        }
        .data-table td {
            background-color: #1E293B; /* slate-800 */
            padding: 1rem;
            vertical-align: middle;
        }
        .data-table tr:hover td {
            background-color: #293548;
        }
        .data-table td:first-child {
            border-top-left-radius: 0.5rem;
            border-bottom-left-radius: 0.5rem;
        }
        .data-table td:last-child {
            border-top-right-radius: 0.5rem;
            border-bottom-right-radius: 0.5rem;
        }
        
        /* Icono de estado */
        .status-icon {
            width: 0.75rem;
            height: 0.75rem;
            border-radius: 50%;
            display: inline-block;
            margin-right: 0.5rem;
            box-shadow: 0 0 5px currentColor;
        }
        .status-active { color: #22c55e; background-color: #22c55e; } /* green-500 */
        .status-paused { color: #f97316; background-color: #f97316; } /* orange-500 */
        
        /* Botones de formulario y filtros */
        .btn {
            padding: 0.625rem 1.25rem;
            border-radius: 0.5rem;
            font-weight: 500;
            transition: all 0.2s ease;
            cursor: pointer;
        }
        .btn-primary {
            background-color: #2563eb; /* blue-600 */
            color: white;
        }
        .btn-primary:hover {
            background-color: #1d4ed8; /* blue-700 */
        }
        .form-input, .form-select {
            background-color: #1E293B; /* slate-800 */
            border: 1px solid #334155; /* slate-700 */
            border-radius: 0.5rem;
            padding: 0.625rem 1rem;
            color: white;
            width: 100%;
        }
        .form-input:focus, .form-select:focus {
            outline: none;
            border-color: #2563eb;
            box-shadow: 0 0 0 2px rgba(37, 99, 235, 0.5);
        }
        
    </style>
</head>
<body class="text-slate-200 font-sans antialiased">

    <div class="flex h-screen overflow-hidden">
        
        <!-- ===== Barra Lateral (Sidebar) ===== -->
        <aside id="sidebar" class="fixed left-0 top-0 z-40 flex h-screen w-64 flex-col overflow-y-hidden bg-[#131B33] border-r border-[#222B45] duration-300 ease-linear -translate-x-full lg:translate-x-0 lg:static">
            
            <!-- Logo -->
            <div class="flex items-center justify-between gap-2 px-6 py-5.5 lg:py-6.5">
                <a href="#" class="flex items-center gap-2">
                    <!-- Puedes reemplazar este SVG por un <img src="logo.png"> -->
                    <svg class="w-8 h-8 text-blue-400" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                    <span class="text-xl font-bold text-white">Nexus</span>
                </a>
                <button class="block lg:hidden" id="sidebar-close">
                    <i data-lucide="x" class="w-6 h-6"></i>
                </button>
            </div>

            <!-- Menú de Navegación -->
            <nav class="flex flex-col flex-1 px-4 py-4 overflow-y-auto">
                <ul class="flex flex-col gap-1.5" id="sidebar-nav">
                    <!-- Dashboard -->
                    <li>
                        <a href="#dashboard" class="nav-link group relative flex items-center gap-2.5 rounded-lg bg-blue-600/20 py-2 px-4 font-medium text-blue-300">
                            <i data-lucide="layout-dashboard"></i>
                            Dashboard
                        </a>
                    </li>
                    <!-- Métricas -->
                    <li>
                        <a href="#metricas" class="nav-link group relative flex items-center gap-2.5 rounded-lg py-2 px-4 font-medium text-slate-400 hover:bg-slate-700/50 hover:text-white">
                            <i data-lucide="bar-chart-3"></i>
                            Métricas
                        </a>
                    </li>
                    <!-- Campañas -->
                    <li>
                        <a href="#campanas" class="nav-link group relative flex items-center gap-2.5 rounded-lg py-2 px-4 font-medium text-slate-400 hover:bg-slate-700/50 hover:text-white">
                            <i data-lucide="target"></i>
                            Campañas
                        </a>
                    </li>
                    <!-- Reportes -->
                    <li>
                        <a href="#reportes" class="nav-link group relative flex items-center gap-2.5 rounded-lg py-2 px-4 font-medium text-slate-400 hover:bg-slate-700/50 hover:text-white">
                            <i data-lucide="file-text"></i>
                            Reportes
                        </a>
                    </li>
                    <!-- Configuración -->
                    <li>
                        <a href="#configuracion" class="nav-link group relative flex items-center gap-2.5 rounded-lg py-2 px-4 font-medium text-slate-400 hover:bg-slate-700/50 hover:text-white">
                            <i data-lucide="settings"></i>
                            Configuración
                        </a>
                    </li>
                </ul>
            </nav>
            
            <!-- Widget de "Vidrio" (Glassmorphism) -->
            <div class="px-6 py-6 mt-auto">
                <div class="glass-card rounded-lg p-5 text-center">
                    <h4 class="font-semibold text-white mb-2">Presupuesto Restante</h4>
                    <!-- Contenido de carga -->
                    <div id="budget-loader" class="skeleton-wrapper">
                        <div class="skeleton h-8 w-3/4 mx-auto mb-3"></div>
                        <div class="skeleton h-4 w-1/2 mx-auto mb-4"></div>
                    </div>
                    <!-- Contenido real -->
                    <div id="budget-content" class="hidden">
                        <div id="budget-remaining" class="text-3xl font-bold text-teal-400 mb-3">...</div>
                        <p class="text-xs text-slate-300 mb-4">Quedan 5 días en el ciclo.</p>
                    </div>
                    <button class="w-full bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-4 rounded-lg transition-colors">
                        Añadir Fondos
                    </button>
                </div>
            </div>
        </aside>
        <!-- ===== Fin Barra Lateral ===== -->

        <!-- ===== Contenido Principal ===== -->
        <div class="relative flex flex-1 flex-col overflow-y-auto overflow-x-hidden">
            
            <!-- ===== Cabecera (Header) ===== -->
            <header class="sticky top-0 z-30 flex w-full bg-[#0B1120]/80 backdrop-blur-sm border-b border-[#222B45]">
                <div class="flex flex-grow items-center justify-between px-4 py-4 md:px-6 2xl:px-11">
                    
                    <!-- Botón de Menú (móvil) y Título -->
                    <div class="flex items-center gap-4">
                        <button class="block lg:hidden" id="sidebar-open">
                            <i data-lucide="menu" class="w-6 h-6"></i>
                        </button>
                        <!-- Título Centrado -->
                        <div class="flex-1 text-center lg:text-left">
                            <h1 class="text-xl font-semibold text-white">Nexus Lanzamiento</h1>
                        </div>
                    </div>

                    <!-- Iconos (antes Perfil) -->
                    <div class="flex items-center gap-4">
                        <button class="p-2 rounded-full hover:bg-slate-700/50">
                            <i data-lucide="search" class="w-5 h-5"></i>
                        </button>
                        
                        <button class="relative p-2 rounded-full hover:bg-slate-700/50">
                            <i data-lucide="bell" class="w-5 h-5"></i>
                            <span class="absolute top-1 right-1 h-2 w-2 rounded-full bg-red-500"></span>
                        </button>
                    </div>
                </div>
            </header>
            <!-- ===== Fin Cabecera ===== -->

            <!-- ===== Área de Contenido Principal ===== -->
            <main id="main-content" class="p-4 md:p-6 2xl:p-10">
                
                <!-- ===== Página: Dashboard (por defecto) ===== -->
                <div id="page-dashboard" class="page-content">
                    
                    <!-- KPIs Principales -->
                    <div class="grid grid-cols-1 gap-4 md:grid-cols-2 md:gap-6 xl:grid-cols-4 2xl:gap-7.5 mb-6">
                        
                        <!-- KPI 1: Leads Totales -->
                        <div class="widget-card rounded-lg p-6 shadow-default">
                            <!-- Contenido de carga -->
                            <div class="kpi-loader skeleton-wrapper">
                                <div class="skeleton h-8 w-3/4 mb-3 rounded"></div>
                                <div class="skeleton h-5 w-1/2 rounded"></div>
                            </div>
                            <!-- Contenido real -->
                            <div class="kpi-content hidden">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h4 class="text-sm font-medium text-slate-400">Leads Totales</h4>
                                        <span id="kpi-leads" class="text-3xl font-bold text-white">...</span>
                                    </div>
                                    <span class="flex items-center justify-center w-12 h-12 rounded-full bg-blue-600/20 text-blue-400">
                                        <i data-lucide="users" class="w-6 h-6"></i>
                                    </span>
                                </div>
                                <div id="kpi-leads-change" class="flex items-center gap-2 mt-2 text-sm">
                                    <!-- Contenido dinámico -->
                                </div>
                            </div>
                        </div>

                        <!-- KPI 2: Costo por Lead (CPL) -->
                        <div class="widget-card rounded-lg p-6 shadow-default">
                            <!-- Contenido de carga -->
                            <div class="kpi-loader skeleton-wrapper">
                                <div class="skeleton h-8 w-3/4 mb-3 rounded"></div>
                                <div class="skeleton h-5 w-1/2 rounded"></div>
                            </div>
                            <!-- Contenido real -->
                            <div class="kpi-content hidden">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h4 class="text-sm font-medium text-slate-400">Costo por Lead (CPL)</h4>
                                        <span id="kpi-cpl" class="text-3xl font-bold text-white">...</span>
                                    </div>
                                    <span class="flex items-center justify-center w-12 h-12 rounded-full bg-teal-600/20 text-teal-400">
                                        <i data-lucide="activity" class="w-6 h-6"></i>
                                    </span>
                                </div>
                                <div id="kpi-cpl-change" class="flex items-center gap-2 mt-2 text-sm">
                                    <!-- Contenido dinámico -->
                                </div>
                            </div>
                        </div>
                        
                        <!-- KPI 3: CTR -->
                        <div class="widget-card rounded-lg p-6 shadow-default">
                            <!-- Contenido de carga -->
                            <div class="kpi-loader skeleton-wrapper">
                                <div class="skeleton h-8 w-3/4 mb-3 rounded"></div>
                                <div class="skeleton h-5 w-1/2 rounded"></div>
                            </div>
                            <!-- Contenido real -->
                            <div class="kpi-content hidden">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h4 class="text-sm font-medium text-slate-400">CTR (Click-Through Rate)</h4>
                                        <span id="kpi-ctr" class="text-3xl font-bold text-white">...</span>
                                    </div>
                                    <span class="flex items-center justify-center w-12 h-12 rounded-full bg-purple-600/20 text-purple-400">
                                        <i data-lucide="percent" class="w-6 h-6"></i>
                                    </span>
                                </div>
                                <div id="kpi-ctr-change" class="flex items-center gap-2 mt-2 text-sm">
                                    <!-- Contenido dinámico -->
                                </div>
                            </div>
                        </div>

                        <!-- KPI 4: Gasto Total -->
                        <div class="widget-card rounded-lg p-6 shadow-default">
                            <!-- Contenido de carga -->
                            <div class="kpi-loader skeleton-wrapper">
                                <div class="skeleton h-8 w-3/4 mb-3 rounded"></div>
                                <div class="skeleton h-5 w-1/2 rounded"></div>
                            </div>
                            <!-- Contenido real -->
                            <div class="kpi-content hidden">
                                <div class="flex items-center justify-between">
                                    <div>
                                        <h4 class="text-sm font-medium text-slate-400">Gasto Total</h4>
                                        <span id="kpi-spend" class="text-3xl font-bold text-white">...</span>
                                    </div>
                                    <span class="flex items-center justify-center w-12 h-12 rounded-full bg-green-600/20 text-green-400">
                                        <i data-lucide="dollar-sign" class="w-6 h-6"></i>
                                    </span>
                                </div>
                                <div class="flex items-center gap-2 mt-2 text-sm text-slate-400">
                                    <span>Últimos 30 días</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Fila de Gráficos Principales -->
                    <div class="grid grid-cols-1 gap-4 md:gap-6 xl:grid-cols-3 2xl:gap-7.5 mb-6">
                        
                        <!-- Gráfico Principal (Leads vs Frecuencia) -->
                        <div class="widget-card rounded-lg p-6 shadow-default xl:col-span-2">
                            <h4 class="text-lg font-semibold text-white mb-4">Leads vs. Frecuencia (Últimos 30 días)</h4>
                            
                            <!-- Contenido de carga -->
                            <div class="chart-loader skeleton-wrapper">
                                <div class="skeleton h-80 w-full rounded-lg"></div>
                            </div>
                            <!-- Contenido real (Gráfico) -->
                            <div class="chart-content hidden h-80">
                                <canvas id="mainChart" class="chart-glow"></canvas>
                            </div>
                        </div>
                        
                        <!-- Gráfico Donut (Leads por País) -->
                        <div class="widget-card rounded-lg p-6 shadow-default">
                            <h4 class="text-lg font-semibold text-white mb-4">Leads por País</h4>
                            
                            <!-- Contenido de carga -->
                            <div class="chart-loader skeleton-wrapper">
                                <div class="skeleton h-80 w-full rounded-lg"></div>
                            </div>
                            <!-- Contenido real (Gráfico) -->
                            <div class="chart-content hidden h-80 flex items-center justify-center">
                                <canvas id="geoChart" class="chart-glow"></canvas>
                            </div>
                        </div>

                    </div>
                    
                    <!-- Fila de Gráficos Secundarios -->
                    <div class="grid grid-cols-1 gap-4 md:gap-6 xl:grid-cols-2 2xl:gap-7.5">

                        <!-- Gráfico de Barras (Top 5 Anuncios) -->
                        <div class="widget-card rounded-lg p-6 shadow-default relative"> 
                            <h4 class="text-lg font-semibold text-white mb-4">Top 5 Anuncios por Leads</h4>
                            
                            <!-- Contenido de carga -->
                            <div class="chart-loader skeleton-wrapper">
                                <div class="skeleton h-80 w-full rounded-lg"></div>
                            </div>
                            <!-- Contenido real (Gráfico) -->
                            <div class="chart-content hidden h-80">
                                <canvas id="topAdsChart"></canvas>
                            </div>
                        </div>
                        
                        <!-- Gráfico de Barras (Rendimiento por Campaña) -->
                        <div class="widget-card rounded-lg p-6 shadow-default">
                            <h4 class="text-lg font-semibold text-white mb-4">CPL por Campaña</h4>
                            
                            <!-- Contenido de carga -->
                            <div class="chart-loader skeleton-wrapper">
                                <div class="skeleton h-80 w-full rounded-lg"></div>
                            </div>
                            <!-- Contenido real (Gráfico) -->
                            <div class="chart-content hidden h-80">
                                <canvas id="campaignChart"></canvas>
                            </div>
                        </div>
                        
                    </div>
                </div> <!-- Fin #page-dashboard -->

                <!-- ===== Página: Métricas ===== -->
                <div id="page-metricas" class="page-content hidden-page">
                    <h2 class="text-2xl font-semibold text-white mb-6">Métricas Detalladas por Campaña</h2>
                    <div class="widget-card rounded-lg p-6 shadow-default overflow-x-auto">
                        <!-- Contenido de carga -->
                        <div class="table-loader skeleton-wrapper">
                            <div class="skeleton h-12 w-full mb-2"></div>
                            <div class="skeleton h-12 w-full mb-2"></div>
                            <div class="skeleton h-12 w-full mb-2"></div>
                            <div class="skeleton h-12 w-full"></div>
                        </div>
                        <!-- Contenido real -->
                        <table id="metrics-table" class="data-table table-content hidden w-full min-w-[1000px]">
                            <thead>
                                <tr>
                                    <th>Campaña</th>
                                    <th>Leads</th>
                                    <th>Gasto</th>
                                    <th>CPL</th>
                                    <th>Impresiones</th>
                                    <th>Clics</th>
                                    <th>CTR</th>
                                    <th>CPC</th>
                                    <th>Frecuencia</th>
                                </tr>
                            </thead>
                            <tbody id="metrics-table-body">
                                <!-- Filas generadas por JS -->
                            </tbody>
                        </table>
                    </div>
                </div> <!-- Fin #page-metricas -->
                
                <!-- ===== Página: Campañas ===== -->
                <div id="page-campanas" class="page-content hidden-page">
                    <h2 class="text-2xl font-semibold text-white mb-6">Gestión de Campañas</h2>
                    <div class="widget-card rounded-lg p-6 shadow-default overflow-x-auto">
                        <!-- Contenido de carga -->
                        <div class="table-loader skeleton-wrapper">
                            <div class="skeleton h-12 w-full mb-2"></div>
                            <div class="skeleton h-12 w-full mb-2"></div>
                            <div class="skeleton h-12 w-full"></div>
                        </div>
                        <!-- Contenido real -->
                        <table id="campaigns-table" class="data-table table-content hidden w-full min-w-[700px]">
                            <thead>
                                <tr>
                                    <th>Estado</th>
                                    <th>Campaña</th>
                                    <th>Gasto</th>
                                    <th>Leads</th>
                                </tr>
                            </thead>
                            <tbody id="campaigns-table-body">
                                <!-- Filas generadas por JS -->
                            </tbody>
                        </table>
                    </div>
                </div> <!-- Fin #page-campanas -->
                
                <!-- ===== Página: Reportes ===== -->
                <div id="page-reportes" class="page-content hidden-page">
                    <h2 class="text-2xl font-semibold text-white mb-6">Generar Reporte</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="widget-card rounded-lg p-6 shadow-default">
                            <h4 class="text-lg font-semibold text-white mb-4">Configuración de Reporte</h4>
                            <form class="space-y-4">
                                <div>
                                    <label class="block mb-2 text-sm font-medium text-slate-300">Tipo de Reporte</label>
                                    <select class="form-select">
                                        <option>Rendimiento General</option>
                                        <option>Desglose por Campaña</option>
                                        <option>Desglose por Anuncio</option>
                                        <option>Desglose Demográfico</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block mb-2 text-sm font-medium text-slate-300">Rango de Fechas</label>
                                    <select class="form-select">
                                        <option>Últimos 7 días</option>
                                        <option>Últimos 30 días</option>
                                        <option>Este mes</option>
                                        <option>Mes pasado</option>
                                    </select>
                                </div>
                                <div>
                                    <label class="block mb-2 text-sm font-medium text-slate-300">Formato</label>
                                    <select class="form-select">
                                        <option>PDF</option>
                                        <option>CSV (Excel)</option>
                                        <option>JSON</option>
                                    </select>
                                </div>
                                <div class="pt-2">
                                    <button type="submit" class="btn btn-primary w-full">
                                        <i data-lucide="download" class="inline-block w-4 h-4 mr-2 -mt-1"></i>
                                        Generar y Descargar
                                    </button>
                                </div>
                            </form>
                        </div>
                        <div class="widget-card rounded-lg p-6 shadow-default">
                            <h4 class="text-lg font-semibold text-white mb-4">Reportes Programados</h4>
                            <p class="text-slate-400 text-center py-10">
                                Próximamente: Programe reportes semanales o mensuales a su email.
                            </p>
                        </div>
                    </div>
                </div> <!-- Fin #page-reportes -->
                
                <!-- ===== Página: Configuración ===== -->
                <div id="page-configuracion" class="page-content hidden-page">
                    <h2 class="text-2xl font-semibold text-white mb-6">Configuración</h2>
                    <div class="widget-card rounded-lg p-6 shadow-default max-w-lg mx-auto">
                        <form class="space-y-6">
                            <div>
                                <label class="block mb-2 text-sm font-medium text-slate-300">Presupuesto Inicial (Mensual)</label>
                                <div class="relative">
                                    <span class="absolute left-3 top-1/2 -translate-y-1/2 text-slate-400">COP</span>
                                    <input type="number" class="form-input pl-12" placeholder="3000000" id="config-budget">
                                </div>
                            </div>
                            
                            <div>
                                <label class="block mb-2 text-sm font-medium text-slate-300">Logo URL (Opcional)</label>
                                <input type="text" class="form-input" placeholder="https://.../logo.png">
                            </div>
                            
                            <div class="flex items-center space-x-3">
                                <input type="checkbox" id="dark-mode" class="w-5 h-5 rounded" checked>
                                <label for="dark-mode" class="text-sm font-medium text-slate-300">Modo Oscuro (Predeterminado)</label>
                            </div>
                            
                            <div class="border-t border-slate-700 pt-6">
                                <button type="submit" class="btn btn-primary w-full">
                                    <i data-lucide="save" class="inline-block w-4 h-4 mr-2 -mt-1"></i>
                                    Guardar Cambios
                                </button>
                            </div>
                        </form>
                    </div>
                </div> <!-- Fin #page-configuracion -->
                
            </main>
            <!-- ===== Fin Área de Contenido Principal ===== -->
            
        </div>
        <!-- ===== Fin Contenido Principal ===== -->

    </div>

    <!-- ===== LÓGICA DE JAVASCRIPT ===== -->
    <script>
        // --- CONFIGURACIÓN ---
        // ¡IMPORTANTE! Esto se debe configurar en la página de Configuración
        // Lo ponemos aquí temporalmente.
        let PRESUPUESTO_INICIAL = 3000000; // 3 Millones COP (Ejemplo)

        // Configuración global de Chart.js para modo oscuro
        Chart.defaults.color = '#94a3b8'; // slate-400
        Chart.defaults.borderColor = '#334155'; // slate-700
        Chart.defaults.font.family = 'Inter, sans-serif';

        // --- Instancias de Gráficos (Global) ---
        let mainChartInstance = null;
        let geoChartInstance = null;
        let topAdsChartInstance = null;
        let campaignChartInstance = null;
        
        // --- Formateador de Moneda (¡NUEVO!) ---
        const currencyFormatter = new Intl.NumberFormat('es-CO', {
            style: 'currency',
            currency: 'COP',
            maximumFractionDigits: 2,
        });
        
        function formatCurrency(value) {
            // Añadimos "COP" al principio para claridad, ya que el símbolo $ es ambiguo
            return "COP " + currencyFormatter.format(value).replace('COP', '').trim();
        }

        // --- Lógica de Navegación (Pestañas) ---
        function setupNavigation() {
            const navLinks = document.querySelectorAll('.nav-link');
            const pages = document.querySelectorAll('.page-content');
            const nav = document.getElementById('sidebar-nav');
            
            const activeClasses = 'bg-blue-600/20 text-blue-300'.split(' ');
            const inactiveClasses = 'text-slate-400 hover:bg-slate-700/50 hover:text-white'.split(' ');

            function showPage(hash) {
                // Quitar 'active' de todos los links
                navLinks.forEach(link => {
                    link.classList.remove(...activeClasses);
                    link.classList.add(...inactiveClasses);
                });
                
                // Ocultar todas las páginas
                pages.forEach(page => page.classList.add('hidden-page'));

                // Encontrar y mostrar el link/página activa
                const targetHash = hash || '#dashboard'; // Por defecto
                const activeLink = nav.querySelector(`a[href="${targetHash}"]`);
                const activePage = document.getElementById(`page-${targetHash.substring(1)}`);
                
                if (activeLink) {
                    activeLink.classList.add(...activeClasses);
                    activeLink.classList.remove(...inactiveClasses);
                }
                
                if (activePage) {
                    activePage.classList.remove('hidden-page');
                } else {
                    // Fallback si la página no existe
                    document.getElementById('page-dashboard').classList.remove('hidden-page');
                    nav.querySelector('a[href="#dashboard"]').classList.add(...activeClasses);
                }
            }
            
            nav.addEventListener('click', (e) => {
                const link = e.target.closest('a.nav-link');
                if (link) {
                    e.preventDefault();
                    const hash = link.hash;
                    window.location.hash = hash; // Actualizar URL
                    showPage(hash);
                }
            });
            
            // Mostrar página correcta al cargar
            showPage(window.location.hash);
        }

        // --- Lógica Principal (Animación, Menú, Gráficos) ---
        document.addEventListener('DOMContentLoaded', () => {
            
            // 1. Inicializar iconos
            try {
                lucide.createIcons();
            } catch (e) {
                console.error("Error al inicializar iconos de Lucide:", e);
            }

            // 2. Lógica del Menú Móvil
            const sidebar = document.getElementById('sidebar');
            const sidebarOpen = document.getElementById('sidebar-open');
            const sidebarClose = document.getElementById('sidebar-close');

            sidebarOpen?.addEventListener('click', () => sidebar.classList.remove('-translate-x-full'));
            sidebarClose?.addEventListener('click', () => sidebar.classList.add('-translate-x-full'));

            // 3. Lógica de Navegación de Pestañas
            setupNavigation();
            
            // 4. Lógica de Carga de Datos
            // Ocultar contenido, mostrar skeletons
            showLoaders(true);
            
            // Iniciar la carga de métricas
            updateAllMetrics();
        });
        
        // --- Control de Estados de Carga ---
        function showLoaders(isLoading) {
            const loaders = [
                ...document.querySelectorAll('.kpi-loader'),
                ...document.querySelectorAll('.chart-loader'),
                ...document.querySelectorAll('.table-loader'),
                document.getElementById('budget-loader')
            ];
            const contents = [
                ...document.querySelectorAll('.kpi-content'),
                ...document.querySelectorAll('.chart-content'),
                ...document.querySelectorAll('.table-content'),
                document.getElementById('budget-content')
            ];

            if (isLoading) {
                loaders.forEach(el => el.classList.remove('hidden'));
                contents.forEach(el => el.classList.add('hidden'));
            } else {
                loaders.forEach(el => el.classList.add('hidden'));
                contents.forEach(el => el.classList.remove('hidden'));
            }
        }
        
        // --- Lógica de Comparación de KPIs ---
        function renderKpiChange(elementId, currentValue, previousValue, isCurrency = false, lowerIsBetter = false) {
            const el = document.getElementById(elementId);
            if (!el) return;

            let changePercent = 0;
            if (previousValue > 0) {
                changePercent = ((currentValue - previousValue) / previousValue) * 100;
            } else if (currentValue > 0) {
                changePercent = 100; // Crecimiento infinito si antes era 0
            }

            let icon, color;
            let isPositive = changePercent >= 0;

            if (lowerIsBetter) {
                isPositive = changePercent <= 0; // Se invierte la lógica
            }

            if (changePercent === 0) {
                icon = 'minus';
                color = 'text-slate-400';
            } else if (isPositive) {
                icon = 'arrow-up-right';
                color = 'text-green-400';
            } else {
                icon = 'arrow-down-right';
                color = 'text-red-400';
            }
            
            const formattedPercent = Math.abs(changePercent).toFixed(1) + '%';
            
            el.innerHTML = `
                <i data-lucide="${icon}" class="w-4 h-4"></i>
                <span class="${color}">${formattedPercent}</span>
                <span class="text-slate-400">vs mes anterior</span>
            `;
            lucide.createIcons({
                nodes: [el.querySelector('i')]
            });
        }
        
        // --- FUNCIÓN PRINCIPAL DE DATOS ---
        
        async function updateAllMetrics() {
            showLoaders(true); // Mostrar esqueletos
            
            // --- ¡CAMBIO IMPORTANTE! ---
            // Detectar si estamos en un servidor (http/https) o en un archivo local (file:)
            const isLocal = window.location.protocol === 'file:';
            
            if (isLocal) {
                // Si es local, no intentes llamar a la API. Usa simulación.
                console.warn("Estás en modo local (file://). Usando datos de simulación.");
                // Retraso simulado para que se vean los skeletons
                setTimeout(() => {
                    runDataSimulation();
                    showLoaders(false); // Ocultar esqueletos después de la simulación
                }, 1500);
                return; // Salir de la función
            }
            // --- FIN DEL CAMBIO ---
            
            try {
                // --- ¡CAMBIO IMPORTANTE! ---
                // Aquí es donde llamamos a nuestro proxy en Vercel.
                // Ya no llamamos a la API de Meta directamente.
                
                const response = await fetch('/api/meta-datos');
                
                if (!response.ok) {
                    // Si el servidor (proxy) falla, response.status será 500 o similar
                    const error = await response.json();
                    throw new Error(error.error || 'Error del servidor');
                }
                
                const data = await response.json();

                // 1. Actualizar KPIs
                document.getElementById('kpi-leads').textContent = data.kpis.leads.toLocaleString('es-CO');
                document.getElementById('kpi-cpl').textContent = formatCurrency(data.kpis.cpl);
                document.getElementById('kpi-ctr').textContent = data.kpis.ctr.toFixed(2) + '%';
                document.getElementById('kpi-spend').textContent = formatCurrency(data.kpis.spend);
                
                renderKpiChange('kpi-leads-change', data.kpis.leads, data.kpis.prev_leads);
                renderKpiChange('kpi-cpl-change', data.kpis.cpl, data.kpis.prev_cpl, true, true); // CPL: más bajo es mejor
                renderKpiChange('kpi-ctr-change', data.kpis.ctr, data.kpis.prev_ctr);

                // 2. Actualizar Presupuesto Restante
                const remaining = PRESUPUESTO_INICIAL - data.kpis.spend;
                document.getElementById('budget-remaining').textContent = formatCurrency(remaining);
                document.getElementById('config-budget').value = PRESUPUESTO_INICIAL; // Sincronizar con config

                // 3. Actualizar Gráficos
                initMainChart(data.kpis.frequency, data.kpis.leads);
                initGeoChart(data.geo);
                initTopAdsChart(data.topAds);
                initCampaignChart(data.campaigns);
                
                // 4. Actualizar Tablas
                populateMetricsTable(data.campaigns);
                populateCampaignsTable(data.campaigns);

            } catch (error) {
                console.error("Error al cargar las métricas (esto es normal si no estás en Vercel):", error.message);
                
                // --- ¡NUEVO! ---
                // Si el fetch falla (ej. al correr localmente), usamos datos de simulación.
                // Esto permite que el dashboard se vea "vivo" para desarrollo.
                // Los datos reales SÓLO funcionarán cuando esté desplegado en Vercel.
                console.warn("Usando datos de simulación como fallback.");
                runDataSimulation(); 
                // --- FIN DEL CAMBIO ---

            } finally {
                // Ocultar esqueletos y mostrar contenido
                // Esta línea se mueve dentro del 'if/else' y 'try/catch'
                // para que no se ejecute dos veces en modo local.
                if (!isLocal) {
                    showLoaders(false);
                }
            }
        }
        
        // --- ¡NUEVA FUNCIÓN DE FALLBACK! ---
        // Esto se llama si updateAllMetrics() falla al contactar la API.
        function runDataSimulation() {
            console.log("Ejecutando simulación de datos...");
            
            // Datos de simulación realistas (en COP)
            const data = {
                kpis: {
                    leads: 482,
                    cpl: 15320.50,
                    ctr: 2.15,
                    spend: 7384281,
                    frequency: 2.8,
                    prev_leads: 450,
                    prev_cpl: 14500.00,
                    prev_ctr: 2.05,
                },
                campaigns: [
                    { campaign_name: "Campaña Tráfico Frío", status: "Active", leads: 301, spend: 4500000, impressions: 500000, clicks: 10000, cpl: 14950.16, ctr: 2.00, cpc: 450, frequency: 3.1 },
                    { campaign_name: "Campaña Remarketing", status: "Active", leads: 181, spend: 2884281, impressions: 150000, clicks: 4500, cpl: 15935.25, ctr: 3.00, cpc: 640.95, frequency: 4.5 },
                    { campaign_name: "Campaña Test A/B", status: "Paused", leads: 0, spend: 0, impressions: 0, clicks: 0, cpl: 0, ctr: 0, cpc: 0, frequency: 0 },
                ],
                topAds: [
                    { ad_name: "Anuncio Video Testimonio", leads: 150 },
                    { ad_name: "Anuncio Gráfico Oferta", leads: 120 },
                    { ad_name: "Anuncio Carrusel", leads: 95 },
                    { ad_name: "Anuncio Test B", leads: 81 },
                    { ad_name: "Anuncio Historias", leads: 36 },
                ],
                geo: [
                    { country_name: "Colombia", leads: 380 },
                    { country_name: "México", leads: 72 },
                    { country_name: "EE.UU. (Hispanos)", leads: 20 },
                    { country_name: "Perú", leads: 10 },
                ]
            };

            // 1. Actualizar KPIs
            document.getElementById('kpi-leads').textContent = data.kpis.leads.toLocaleString('es-CO');
            document.getElementById('kpi-cpl').textContent = formatCurrency(data.kpis.cpl);
            document.getElementById('kpi-ctr').textContent = data.kpis.ctr.toFixed(2) + '%';
            document.getElementById('kpi-spend').textContent = formatCurrency(data.kpis.spend);
            
            renderKpiChange('kpi-leads-change', data.kpis.leads, data.kpis.prev_leads);
            renderKpiChange('kpi-cpl-change', data.kpis.cpl, data.kpis.prev_cpl, true, true); // CPL: más bajo es mejor
            renderKpiChange('kpi-ctr-change', data.kpis.ctr, data.kpis.prev_ctr);

            // 2. Actualizar Presupuesto Restante
            const remaining = PRESUPUESTO_INICIAL - data.kpis.spend;
            document.getElementById('budget-remaining').textContent = formatCurrency(remaining);
            document.getElementById('config-budget').value = PRESUPUESTO_INICIAL; // Sincronizar con config

            // 3. Actualizar Gráficos
            initMainChart(data.kpis.frequency, data.kpis.leads);
            initGeoChart(data.geo);
            initTopAdsChart(data.topAds);
            initCampaignChart(data.campaigns);
            
            // 4. Actualizar Tablas
            populateMetricsTable(data.campaigns);
            populateCampaignsTable(data.campaigns);
        }
        // --- FIN DE LA NUEVA FUNCIÓN ---


        // --- Inicialización de Gráficos ---

        // 1. Gráfico Principal (Leads vs Frecuencia)
        function initMainChart(frequency, leads) {
            const ctx = document.getElementById('mainChart');
            if (!ctx) return;
            
            // Datos simulados para un gráfico de área (ya que solo tenemos totales)
            const labels = ['Sem 1', 'Sem 2', 'Sem 3', 'Sem 4'];
            const leadsData = [leads * 0.1, leads * 0.3, leads * 0.2, leads * 0.4];
            const freqData = [frequency * 0.8, frequency * 0.9, frequency * 1.1, frequency];

            const gradientBlue = ctx.getContext('2d').createLinearGradient(0, 0, 0, 400);
            gradientBlue.addColorStop(0, 'rgba(59, 130, 246, 0.5)');
            gradientBlue.addColorStop(1, 'rgba(59, 130, 246, 0)');
            
            if (mainChartInstance) mainChartInstance.destroy();
            mainChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Leads',
                            data: leadsData,
                            borderColor: '#3B82F6', // blue-500
                            backgroundColor: gradientBlue,
                            fill: true,
                            tension: 0.4,
                            yAxisID: 'yLeads',
                        },
                        {
                            label: 'Frecuencia',
                            data: freqData,
                            borderColor: '#14B8A6', // teal-500
                            fill: false,
                            tension: 0.4,
                            yAxisID: 'yFrequency',
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        yLeads: {
                            type: 'linear',
                            position: 'left',
                            grid: { display: false },
                            ticks: { callback: (value) => value.toLocaleString('es-CO') }
                        },
                        yFrequency: {
                            type: 'linear',
                            position: 'right',
                            grid: { display: false },
                            ticks: { callback: (value) => value.toFixed(1) }
                        }
                    },
                    plugins: { tooltip: { mode: 'index', intersect: false } }
                }
            });
        }

        // 2. Gráfico Donut (Leads por País)
        function initGeoChart(geoData) {
            const ctx = document.getElementById('geoChart');
            if (!ctx) return;
            
            const labels = geoData.map(g => g.country_name);
            const data = geoData.map(g => g.leads);
            
            if (geoChartInstance) geoChartInstance.destroy();
            geoChartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Leads',
                        data: data,
                        backgroundColor: ['#3B82F6', '#14B8A6', '#8B5CF6', '#EC4899', '#F97316'],
                        borderWidth: 0,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom' },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `${context.label}: ${context.raw.toLocaleString('es-CO')} Leads`;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // 3. Gráfico de Barras (Top 5 Anuncios)
        function initTopAdsChart(adData) {
            const ctx = document.getElementById('topAdsChart');
            if (!ctx) return;

            const labels = adData.map(ad => ad.ad_name.length > 20 ? ad.ad_name.substring(0, 20) + '...' : ad.ad_name);
            const data = adData.map(ad => ad.leads);
            
            if (topAdsChartInstance) topAdsChartInstance.destroy();
            topAdsChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Leads',
                        data: data,
                        backgroundColor: '#3B82F6',
                        borderRadius: 4,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    indexAxis: 'y', // Barras horizontales
                    scales: { x: { grid: { display: false } } },
                    plugins: { legend: { display: false } }
                }
            });
        }
        
        // 4. Gráfico de Barras (CPL por Campaña)
        function initCampaignChart(campaignData) {
            const ctx = document.getElementById('campaignChart');
            if (!ctx) return;
            
            // Ordenar por CPL y tomar las top 7
            const sortedData = [...campaignData].sort((a, b) => b.cpl - a.cpl).slice(0, 7);
            
            const labels = sortedData.map(c => c.campaign_name.length > 15 ? c.campaign_name.substring(0, 15) + '...' : c.campaign_name);
            const data = sortedData.map(c => c.cpl);
            
            if (campaignChartInstance) campaignChartInstance.destroy();
            campaignChartInstance = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Costo por Lead (CPL)',
                        data: data,
                        backgroundColor: '#8B5CF6',
                        borderRadius: 4,
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            ticks: {
                                callback: function(value) {
                                    return formatCurrency(value);
                                }
                            }
                        }
                    },
                    plugins: { 
                        legend: { display: false },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return `CPL: ${formatCurrency(context.raw)}`;
                                }
                            }
                        }
                    }
                }
            });
        }
        
        // --- Lógica para poblar Tablas ---
        
        // 5. Tabla de Métricas Detalladas
        function populateMetricsTable(campaigns) {
            const tbody = document.getElementById('metrics-table-body');
            if (!tbody) return;
            
            tbody.innerHTML = ''; // Limpiar tabla
            
            campaigns.forEach(c => {
                const row = `
                    <tr>
                        <td class="font-medium text-white">${c.campaign_name}</td>
                        <td class="text-white font-medium">${c.leads.toLocaleString('es-CO')}</td>
                        <td>${formatCurrency(c.spend)}</td>
                        <td class="text-white font-medium">${formatCurrency(c.cpl)}</td>
                        <td>${c.impressions.toLocaleString('es-CO')}</td>
                        <td>${c.clicks.toLocaleString('es-CO')}</td>
                        <td>${c.ctr.toFixed(2)}%</td>
                        <td>${formatCurrency(c.cpc)}</td>
                        <td>${c.frequency.toFixed(2)}</td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }
        
        // 6. Tabla de Estado de Campañas
        function populateCampaignsTable(campaigns) {
            const tbody = document.getElementById('campaigns-table-body');
            if (!tbody) return;
            
            tbody.innerHTML = ''; // Limpiar tabla
            
            campaigns.forEach(c => {
                const statusClass = c.status === 'Active' ? 'status-active' : 'status-paused';
                const statusText = c.status === 'Active' ? 'Activa' : 'Pausada';
                
                const row = `
                    <tr>
                        <td>
                            <span class="flex items-center">
                                <span class="status-icon ${statusClass}"></span>
                                ${statusText}
                            </span>
                        </td>
                        <td class="font-medium text-white">${c.campaign_name}</td>
                        <td>${formatCurrency(c.spend)}</td>
                        <td class="text-white font-medium">${c.leads.toLocaleString('es-CO')}</td>
                    </tr>
                `;
                tbody.innerHTML += row;
            });
        }

    </script>
</body>
</html>
